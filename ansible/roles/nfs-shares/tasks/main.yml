  - name: Load NFS Shares file
    include_vars:
      file: "../clusters/{{ cluster_name }}/nfs_shares.yml"

  - debug: msg="{{ nfs_shares }}"

  - name: Ensure the NFS mounts exist
    file:
      path: "{{ item.folder }}"
      state: directory
    with_items: 
      - "{{ nfs_shares }}"

  - name: Create fstab entry for shared storage and backup volumes
    lineinfile:
      path: "/etc/fstab"
      state: present
      line: "{{ item.fstab }}"
    with_items: 
      - "{{ nfs_shares }}"

  - name: Mount the volumes
    shell: mount {{ item.folder }}
    with_items: 
      - "{{ nfs_shares }}"

  - name: List the volume
    shell: ls -al "{{ item.folder }}"
    register: local_out
    with_items: 
      - "{{ nfs_shares }}"

  - debug: msg="{{ local_out.stdout_lines }}"
