- name: Copy the join_cmd
  copy:
    dest: /root/join_cmd
    src: ../clusters/{{ cluster_pkg_folder }}/join_cmd
    mode: 0766   
  become: true   

- name: Update K8s repo
  shell: "yum -y update"
  become: true

- name: Install Kubernetes on Worker nodes (CentOS)
  yum: > 
    pkg={{item}} 
    state=present
  with_items:
    - kubectl-1.12.0-0
    - kubeadm-1.12.1-0
    - kubelet-1.12.0-0
  when: cluster_type != "fedora-k8s"

- name: Install Kubernetes on Worker nodes (Fedora)
  dnf: > 
    pkg={{item}} 
    state=present
  with_items:
    - kubectl-1.12.0-0
    - kubeadm-1.12.1-0
    - kubelet-1.12.0-0
  when: cluster_type == "fedora-k8s"

- name: Start kubelet on Worker nodes
  service:
    name: kubelet
    state: started
    enabled: yes
  become: true

- name: Join Worker to Cluster
  shell: "/root/join_cmd"
  register: worker_join

- name: Worker Join Result
  debug: msg="{{ worker_join.stdout_lines }}"
