#- name: patch CoreDNS memory limit to deal with bug in 1.12.1
#  shell: "kubectl patch deployment -n=kube-system coredns -p '{\"spec\": {\"template\": {\"spec\":{\"containers\":[{\"image\":\"k8s.gcr.io/coredns:1.2.2\", \"name\":\"coredns\",\"resources\":{\"limits\":{\"memory\":\"512Mi\"},\"requests\":{\"cpu\":\"100m\",\"memory\":\"70Mi\"}}}]}}}}'"
#  register: patch_out

#- debug: msg="{{ patch_out.stdout_lines }}"

- name: apply the temporary coredns loop patch 
  include: coredns-loop.yml
  when: k8s_coredns_loop_check_disable == "true"
