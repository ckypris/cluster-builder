---
- name: Configure the docker daemon.json 
  template:
    src: templates/docker-daemon-default.j2
    dest: /etc/docker/daemon.json
    mode: 0755

- name: Install cadvisor  
  shell: 
    cmd: | 
      docker run \
        --privileged=true \
        --restart=always \
        --memory 536870912 \
        --volume=/cgroup:/cgroup:ro \
        --volume=/:/rootfs:ro \
        --volume=/var/run:/var/run:rw \
        --volume=/sys:/sys:ro \
        --volume=/var/lib/docker/:/var/lib/docker:ro \
        --volume=/dev/disk/:/dev/disk:ro \
        --publish=9101:8080 \
        --detach=true \
        --name=cadvisor \
        google/cadvisor:latest    

- name: Restart the docker daemon with monitoring configuration
  service:
    name: docker
    state: restarted
    enabled: yes  
